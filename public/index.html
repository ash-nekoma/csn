<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Stick N' Trade | Casino</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800;900&family=Rajdhani:wght@600;700;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="/socket.io/socket.io.js"></script>
<style>
:root { --ps-bg: #000814; --ps-glow: #00a2ff; --glass-bg: rgba(0, 15, 35, 0.65); --glass-border: rgba(255, 255, 255, 0.15); --danger: #ff3366; --success: #00e676; --credits: #ffb400; --text-main: #f8fafc; --text-muted: #8c9eb5;}
* { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Outfit', sans-serif; outline: none; -webkit-tap-highlight-color: transparent;}
body { background: linear-gradient(135deg, #000a1f 0%, #001f4d 50%, #000000 100%); color: var(--text-main); min-height: 100vh; overflow-x: hidden;}
::-webkit-scrollbar { display: none; }
.custom-scroll::-webkit-scrollbar { width: 6px; display: block; } .custom-scroll::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 10px; }
input[type="number"]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
.hidden { display: none !important; opacity: 0; pointer-events: none; }
.btn-play { background: rgba(255,255,255,0.1); color: white; border: 1px solid var(--glass-border); padding: 15px 20px; border-radius: 8px; font-size: 1.1rem; font-weight: 900; cursor: pointer; transition: 0.2s; text-transform: uppercase; letter-spacing: 1px; }
.btn-play:hover:not(:disabled) { background: white; color: black; transform: translateY(-2px); box-shadow: 0 5px 20px rgba(255,255,255,0.2); }
.btn-play:disabled { background: rgba(0,0,0,0.5); color: var(--text-muted); cursor: not-allowed; border-color: transparent; }
.input-control { width: 100%; padding: 15px; background: rgba(0,0,0,0.5); border: 1px solid var(--glass-border); color: white; border-radius: 8px; font-size: 1.1rem; font-weight: 600; text-align: center;}
.input-control:focus { border-color: var(--ps-glow); }
.input-group label { display: block; color: var(--text-muted); font-size: 0.85rem; text-transform: uppercase; font-weight: 800; margin-bottom: 5px; text-align: left;}

/* AUTH */
#auth-container { position: fixed; inset: 0; display: flex; justify-content: center; align-items: center; z-index: 9999999; background: rgba(0,0,0,0.85); backdrop-filter: blur(15px); }
.auth-box { width: 450px; background: var(--glass-bg); padding: 3rem; border-radius: 16px; border: 1px solid var(--glass-border); text-align: center; }
.auth-tabs { display: flex; gap: 10px; margin-bottom: 25px; border-bottom: 1px solid var(--glass-border); }
.auth-tab { flex: 1; background: transparent; border: none; color: var(--text-muted); font-weight: 900; padding: 10px; cursor: pointer; text-transform: uppercase; }
.auth-tab.active { border-bottom: 3px solid var(--ps-glow); color: var(--ps-glow); }
.auth-msg { font-size: 0.9rem; font-weight: 800; min-height: 20px; margin-bottom: 15px; } .auth-error { color: var(--danger); } .auth-success { color: var(--success); }

/* TOPBAR */
.topbar { position: fixed; top: 0; left: 0; right: 0; z-index: 99999; background: rgba(0,0,0,0.6); border-bottom: 1px solid var(--glass-border); backdrop-filter: blur(16px); padding: 12px 25px; display: flex; justify-content: space-between; align-items: center; }
.brand-title { font-weight: 900; letter-spacing: 2px; font-size: 1.5rem; } .brand-sub { color: var(--ps-glow); font-weight: 800; font-size: 0.8rem; letter-spacing: 3px; }
.wallet-pill { background: rgba(0,0,0,0.5); border: 1px solid rgba(255,180,0,0.3); padding: 8px 15px; border-radius: 8px; display: flex; align-items: center; gap: 10px; font-weight: 900; font-size: 1.1rem; color: var(--credits); cursor: pointer; transition: 0.3s; }
.wallet-pill:hover { transform: translateY(-2px); border-color: var(--credits); }
.top-icon-btn { cursor: pointer; color: white; width: 34px; height: 34px; border-radius: 50%; background: transparent; border: none; font-size: 1.15rem; transition: 0.2s;} .top-icon-btn:hover { background: rgba(255,255,255,0.15); transform: scale(1.1); }

/* LOBBY & GAMES */
.main-wrapper { padding-top: 100px; display: flex; flex-direction: column; align-items: center; width: 100%;}
.mode-card, .game-card { background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: 16px; cursor: pointer; transition: 0.3s; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; overflow: hidden; position: relative;}
.mode-card { width: 320px; height: 400px; padding: 20px;} .mode-card:hover { border-color: var(--ps-glow); transform: translateY(-10px); }
.game-card { width: 280px; height: 380px;} .game-card:hover { border-color: white; transform: translateY(-8px); }
.game-img { flex: 1; width: 100%; display: flex; align-items: center; justify-content: center; font-size: 6rem; background: rgba(0,0,0,0.5); color: var(--ps-light-blue); transition: 0.3s;}
.game-card:hover .game-img { color: white; text-shadow: 0 0 20px var(--ps-glow); }
.game-info { height: 100px; width: 100%; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; font-size: 1.4rem; font-weight: 900; text-transform: uppercase;}

/* IN-GAME */
.game-box, .shared-layout { display: flex; gap: 20px; height: 650px; width: 100%; max-width: 900px; margin: 0 auto; }
.shared-layout { max-width: 1100px; }
.glass-panel { background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: 12px; display: flex; flex-direction: column; flex: 1; overflow: hidden;}
.glass-header { background: rgba(0,0,0,0.8); padding: 15px 20px; border-bottom: 1px solid var(--glass-border); display: flex; justify-content: space-between; align-items: center; font-weight: 900; font-size: 1.3rem; text-transform: uppercase;}
.game-display { flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; position: relative; padding: 20px;}
.controls-grid { padding: 25px; background: rgba(0,0,0,0.8); border-top: 1px solid var(--glass-border); display: flex; flex-direction: column; gap: 15px;}
.bet-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; width: 100%; }
.bet-btn { background: rgba(0,0,0,0.6); border: 1px solid var(--glass-border); color: white; padding: 15px; border-radius: 8px; font-weight: 900; cursor: pointer; text-transform: uppercase; transition: 0.2s;}
.bet-btn:hover { background: rgba(255,255,255,0.1); transform: translateY(-2px); }
.bet-btn.has-bet { border-color: var(--tile-color); box-shadow: inset 0 0 10px rgba(255,255,255,0.1), 0 0 15px var(--tile-color); transform: translateY(-3px); }

/* ANIMATIONS & ASSETS */
.dice-icon { font-size: 7rem; text-shadow: 0 10px 30px rgba(0,0,0,0.8); } #dice-num { font-size: 6rem; font-weight: 900; }
.anim-shake { animation: shake 0.3s infinite; } @keyframes shake { 0%,100%{transform:rotate(0deg);} 25%{transform:rotate(-15deg);} 75%{transform:rotate(15deg);} }
.coin-wrapper { width: 200px; height: 200px; perspective: 1000px; } .coin-inner { width: 100%; height: 100%; transition: transform 2.5s cubic-bezier(0.25,1,0.2,1); transform-style: preserve-3d; position: relative; }
.coin-face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; display: flex; align-items: center; justify-content: center; font-size: 5rem; border-radius: 50%; border: 8px solid; }
.coin-heads { background: radial-gradient(circle, #fde047, #b45309); color: #78350f; border-color: #f59e0b; } .coin-tails { background: radial-gradient(circle, #e2e8f0, #475569); color: #0f172a; border-color: #94a3b8; transform: rotateY(180deg); }
.tossing { animation: toss 2.5s cubic-bezier(0.25,1,0.2,1); } @keyframes toss { 0%,100%{transform:scale(1) translateY(0);} 50%{transform:scale(1.5) translateY(-50px);} }
.play-card { background: white; color: black; width: 65px; height: 95px; border-radius: 6px; display: flex; flex-direction: column; align-items: center; justify-content: center; font-weight: 900; font-size: 1.6rem; border: 1px solid #ccc; box-shadow: 0 5px 15px rgba(0,0,0,0.5); }
.card-red { color: #e60000; } .card-back { background: repeating-linear-gradient(45deg, #001f4d, #000a1f 10px); color: transparent; border: 2px solid white; }
.anim-deal { animation: deal 0.4s ease-out; } @keyframes deal { 0%{opacity:0; transform:translateY(-100px) rotateY(180deg);} 100%{opacity:1; transform:translateY(0) rotateY(0deg);} }

/* DAILY REWARD */
.dr-days { display: flex; gap: 10px; justify-content: center; align-items: flex-end; margin-bottom: 25px; height: 160px; }
.dr-day { flex: 1; background: linear-gradient(180deg, #1a2a6c, #001f4d); border: 2px solid rgba(255,255,255,0.2); border-radius: 8px; display: flex; flex-direction: column; align-items: center; justify-content: space-between; padding: 10px 5px; height: 130px; position: relative; overflow: hidden; transition: 0.3s; }
.dr-day::before { content: ''; position: absolute; inset: -50%; background: repeating-conic-gradient(rgba(255,255,255,0.08) 0 15deg, transparent 15deg 30deg); opacity: 0.8; animation: spin 20s linear infinite; z-index: 0; }
@keyframes spin { 100% { transform: rotate(360deg); } }
.dr-day > * { position: relative; z-index: 1; }
.dr-day.claimed { filter: grayscale(1); opacity: 0.6; } .dr-day.claimed::before { display: none; }
.dr-day.active { background: linear-gradient(180deg, #ffcc00, #ff9900); border-color: white; transform: scale(1.1); height: 150px; color: black; z-index: 5; }
.dr-day.active::before { background: repeating-conic-gradient(rgba(255,255,255,0.3) 0 15deg, transparent 15deg 30deg); opacity: 0.6; }
.dr-day.active .dr-title, .dr-day.active .dr-coin { color: black; text-shadow: none; }
.dr-day.active.active-claimed { background: rgba(255,255,255,0.1); border-color: var(--glass-border); filter: grayscale(1); color: white; }
.dr-day.active.active-claimed .dr-title, .dr-day.active.active-claimed .dr-coin { color: white; }
.dr-day.active.active-claimed::before { display: block; opacity: 0.3; } /* Keep animation spinning */
.dr-title { font-size: 0.9rem; font-weight: 900; text-transform: uppercase; color: white; text-shadow: 0 1px 3px rgba(0,0,0,0.5); }
.dr-coin { font-size: 1rem; font-weight: 900; color: white; text-shadow: 0 1px 3px rgba(0,0,0,0.5); text-align: center; }
#dr-status-container { text-align: center; margin-top: 10px; }
.dr-status-text { font-size: 1.2rem; font-weight: 900; color: var(--text-muted); text-transform: uppercase; letter-spacing: 2px;}
.dr-timer { font-size: 1.5rem; font-weight: 900; color: var(--ps-glow); font-family: 'Rajdhani', sans-serif;}

/* TOAST & RESULTS */
.toast { position: fixed; top: 20px; right: 20px; background: rgba(5,10,25,0.95); padding: 15px 25px; border-radius: 8px; border-left: 5px solid var(--ps-glow); color: white; font-weight: 800; transform: translateX(120%); transition: 0.4s; z-index: 9999999; box-shadow: 0 10px 30px rgba(0,0,0,0.5);}
.toast.show { transform: translateX(0); } .toast-error { border-color: var(--danger); }
.result-box { position: absolute; bottom: 20px; right: 20px; padding: 15px 30px; border-radius: 8px; text-align: right; font-weight: 900; text-transform: uppercase; display: none; z-index: 100; box-shadow: 0 10px 30px rgba(0,0,0,0.8); backdrop-filter: blur(10px); animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);}
.result-box.win { background: rgba(0,230,118,0.15); border: 1px solid var(--success); color: var(--success); border-right: 4px solid var(--success); }
.result-box.lose { background: rgba(255,51,102,0.15); border: 1px solid var(--danger); color: var(--danger); border-right: 4px solid var(--danger); }
.result-box.push { background: rgba(255,255,255,0.1); border: 1px solid white; color: white; border-right: 4px solid white; }
@keyframes popIn { 0%{transform: scale(0.8) translateX(50px); opacity:0;} 100%{transform: scale(1) translateX(0); opacity:1;} }
.anim-pop { animation: popBal 0.5s ease-out; } @keyframes popBal { 50%{transform: scale(1.1); background: rgba(0,230,118,0.3); border-color: var(--success);} }

/* MODALS */
.modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.85); z-index: 100000; display: flex; justify-content: center; align-items: center; backdrop-filter: blur(10px); }
.modal-content { background: var(--glass-bg); width: 500px; padding: 2.5rem; border-radius: 12px; border: 1px solid var(--glass-border); position: relative; display: flex; flex-direction: column; }
.modal-close-icon { position: absolute; top: 20px; right: 20px; font-size: 1.5rem; cursor: pointer; color: var(--text-muted); transition: 0.2s;} .modal-close-icon:hover { color: var(--danger); }
</style>
</head>
<body>

  <div id="toast-container"></div>

  <div id="auth-container">
      <div class="auth-box">
          <div class="auth-title">STICK N' TRADE</div><div class="auth-sub">CASINO</div>
          <div class="auth-tabs"><button class="auth-tab active" onclick="switchAuthTab('login')">Login</button><button class="auth-tab" onclick="switchAuthTab('register')">Register</button></div>
          <div id="auth-form-login">
              <div class="input-group"><input type="text" id="login-user" class="input-control" placeholder="Username" style="margin-bottom:15px;"></div>
              <div class="input-group pwd-input-wrapper" style="margin-bottom:15px;"><input type="password" id="login-pass" class="input-control" placeholder="Password"><i class="fas fa-eye" onclick="toggleInputPwd('login-pass', this)"></i></div>
              <div id="auth-error-login" class="auth-msg auth-error"></div>
              <button class="btn-play" style="width:100%;" onclick="submitAuth('login')">LOGIN</button>
          </div>
          <div id="auth-form-register" class="hidden">
              <div class="input-group"><input type="text" id="reg-user" class="input-control" placeholder="Username" style="margin-bottom:15px;"></div>
              <div class="input-group pwd-input-wrapper" style="margin-bottom:15px;"><input type="password" id="reg-pass" class="input-control" placeholder="Password"><i class="fas fa-eye" onclick="toggleInputPwd('reg-pass', this)"></i></div>
              <div id="auth-error-register" class="auth-msg auth-error"></div>
              <button class="btn-play" style="width:100%; border-color:var(--success); color:var(--success);" onclick="submitAuth('register')">REGISTER</button>
          </div>
      </div>
  </div>

  <div id="app-container">
    <header class="topbar">
      <div class="topbar-inner">
        <div class="brand" onclick="switchView('casino')"><div class="brand-dot"></div><div><div class="brand-title">STICK N' TRADE</div><div class="brand-sub">CASINO</div></div></div>
        <div class="topbar-right">
          <div class="player-profile"><i class="fas fa-user-circle"></i> <span id="player-name-display">Player</span></div>
          <div class="wallet-pill" id="pill-credits" onclick="openModal('support-center-modal')"><i class="fas fa-coins"></i> <span id="nav-credits">0</span> <span style="font-size:0.8rem; opacity:0.6;">TC</span></div>
          <div class="topbar-actions">
              <button class="top-icon-btn" onclick="openModal('daily-reward-modal')"><i class="fas fa-calendar-check" style="color:var(--credits)"></i></button>
              <button class="top-icon-btn" id="mute-btn" onclick="toggleAudio()"><i class="fas fa-volume-up"></i></button>
              <button class="top-icon-btn" onclick="location.reload()"><i class="fas fa-sign-out-alt" style="color:var(--danger);"></i></button>
          </div>
        </div>
      </div>
    </header>

    <div class="main-wrapper">
        <div id="view-casino" class="view-container">
            <h1 class="casino-title">STICK N' TRADE CASINO</h1>
            <div id="lobby-modes" class="lobby-modes-container" style="display:flex;">
                <div class="mode-card" onclick="openLobbyMode('indiv')"><i class="fas fa-user mode-icon"></i><div class="mode-title">SOLO PLAY</div><div class="mode-desc">Single-player quick rounds.</div></div>
                <div class="mode-card" onclick="openLobbyMode('shared')"><i class="fas fa-users mode-icon"></i><div class="mode-title">SHARED TABLES</div><div class="mode-desc">Multiplayer live rooms.</div></div>
            </div>
            
            <div id="lobby-indiv" class="hidden" style="margin-top:20px;">
                <button class="btn-play" style="margin-bottom:20px;" onclick="openLobbyMode('modes')">Back</button>
                <div class="casino-grid">
                    <div class="game-card" onclick="openGame('dice')"><div class="game-img"><i class="fas fa-dice"></i></div><div class="game-info">Dice Roll</div></div>
                    <div class="game-card" onclick="openGame('coinflip')"><div class="game-img"><i class="fas fa-coins"></i></div><div class="game-info">Coin Flip</div></div>
                    <div class="game-card" onclick="openGame('blackjack')"><div class="game-img">‚ô†Ô∏è</div><div class="game-info">Blackjack</div></div>
                </div>
            </div>

            <div id="lobby-shared" class="hidden" style="margin-top:20px;">
                <button class="btn-play" style="margin-bottom:20px;" onclick="openLobbyMode('modes')">Back</button>
                <div class="casino-grid">
                    <div class="game-card" onclick="openSharedGame('baccarat')"><div class="game-img">üÉè</div><div class="game-info">Baccarat</div></div>
                    <div class="game-card" onclick="openSharedGame('perya')"><div class="game-img"><i class="fas fa-dice-d6"></i></div><div class="game-info">Color Game</div></div>
                    <div class="game-card" onclick="openSharedGame('dt')"><div class="game-img"><i class="fas fa-dragon"></i></div><div class="game-info">Dragon Tiger</div></div>
                    <div class="game-card" onclick="openSharedGame('sicbo')"><div class="game-img"><i class="fas fa-dice"></i></div><div class="game-info">Sic Bo</div></div>
                </div>
            </div>
        </div>

        <div id="view-game-dice" class="view-container hidden">
            <button class="btn-play" style="margin-bottom:20px;" onclick="switchView('casino')">Leave Table</button>
            <div class="game-box">
                <div class="glass-panel">
                    <div class="glass-header"><span>Dice Roll</span><div><button class="btn-rules" onclick="openRules('dice')"><i class="fas fa-info-circle"></i></button></div></div>
                    <div class="game-display"><i class="fas fa-dice-d20 dice-icon" id="dice-icon"></i><div id="dice-num" style="display:none; color:white;">0</div><div id="dice-msg" class="result-box"></div></div>
                    <div class="controls-grid" style="align-items:center;">
                        <input type="number" id="dice-bet" class="input-control" placeholder="Bet Amount" style="max-width:200px;">
                        <button class="btn-play" id="btn-dice" onclick="playDice()" style="width:200px; background:var(--ps-glow); color:#000;">ROLL (2x)</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="view-game-coinflip" class="view-container hidden">
            <button class="btn-play" style="margin-bottom:20px;" onclick="switchView('casino')">Leave Table</button>
            <div class="game-box">
                <div class="glass-panel">
                    <div class="glass-header"><span>Coin Flip</span><div><button class="btn-rules" onclick="openRules('coinflip')"><i class="fas fa-info-circle"></i></button></div></div>
                    <div class="game-display">
                        <div class="coin-wrapper" id="coin-wrapper"><div class="coin-inner" id="coin-obj"><div class="coin-face coin-heads"><i class="fas fa-coins"></i></div><div class="coin-face coin-tails"><i class="fas fa-gem"></i></div></div></div>
                        <div id="coin-msg" class="result-box"></div>
                    </div>
                    <div class="controls-grid" style="align-items:center;">
                        <input type="number" id="coin-bet" class="input-control" placeholder="Bet Amount" style="max-width:200px;">
                        <div style="display:flex;gap:10px;"><button class="btn-play" id="btn-heads" onclick="playCoin('Heads')" style="border-color:var(--credits); color:var(--credits);">Heads</button><button class="btn-play" id="btn-tails" onclick="playCoin('Tails')">Tails</button></div>
                    </div>
                </div>
            </div>
        </div>

        <div id="view-game-blackjack" class="view-container hidden">
            <button class="btn-play" style="margin-bottom:20px;" onclick="switchView('casino')">Leave Table</button>
            <div class="game-box" style="max-width:1000px;">
                <div class="glass-panel">
                    <div class="glass-header"><span>Blackjack</span><div><button class="btn-rules" onclick="openRules('blackjack')"><i class="fas fa-info-circle"></i></button></div></div>
                    <div class="game-display">
                        <div style="display:flex;gap:50px;width:100%;justify-content:center;">
                            <div style="text-align:center;background:rgba(0,0,0,0.5);padding:20px;border-radius:12px;width:300px;"><div style="color:var(--text-muted);font-weight:900;">DEALER</div><div id="bj-d-score" style="font-size:2rem;font-weight:900;">0</div><div id="bj-d-hand" style="display:flex;gap:5px;justify-content:center;min-height:100px;"></div></div>
                            <div style="text-align:center;background:rgba(0,0,0,0.5);padding:20px;border-radius:12px;width:300px;"><div style="color:var(--ps-glow);font-weight:900;">YOU</div><div id="bj-p-score" style="font-size:2rem;font-weight:900;">0</div><div id="bj-p-hand" style="display:flex;gap:5px;justify-content:center;min-height:100px;"></div></div>
                        </div>
                        <div id="bj-msg" class="result-box"></div>
                    </div>
                    <div class="controls-grid" id="bj-start-controls" style="align-items:center;">
                        <input type="number" id="bj-bet" class="input-control" placeholder="Bet Amount" style="max-width:200px;">
                        <button class="btn-play" id="btn-bj-deal" onclick="startBlackjack()" style="width:200px; background:var(--ps-glow); color:#000;">DEAL</button>
                    </div>
                    <div class="controls-grid hidden" id="bj-action-controls" style="display:flex; flex-direction:row; justify-content:center;">
                        <button class="btn-play" id="btn-bj-hit" onclick="hitBlackjack()" style="border-color:var(--ps-glow); color:var(--ps-glow); width:150px;">HIT</button>
                        <button class="btn-play" id="btn-bj-stand" onclick="standBlackjack()" style="border-color:var(--danger); color:var(--danger); width:150px;">STAND</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="view-shared-game" class="view-container hidden">
            <button class="btn-play" style="margin-bottom:20px;" onclick="backToSharedLobby()">Leave Table</button>
            <div class="shared-layout">
                <div class="glass-panel main-panel">
                    <div class="glass-header"><span id="sg-title">Table</span><div class="timer-box" id="sg-timer-box"><i class="fas fa-clock"></i> <span id="sg-timer">15</span>s</div></div>
                    <div class="game-display" id="sg-display"></div>
                    <div class="controls-grid" id="sg-controls-container"></div>
                </div>
                <div class="glass-panel chat-panel">
                    <div class="glass-header">LIVE CHAT</div>
                    <div class="chat-body custom-scroll" id="sg-chat"></div>
                    <div style="padding:15px; border-top:1px solid var(--glass-border);"><input type="text" id="chat-input" class="input-control" placeholder="Chat..." onkeypress="if(event.key==='Enter') sendChat()"></div>
                </div>
            </div>
        </div>
    </div>
  </div>

  <div id="daily-reward-modal" class="modal-overlay hidden">
    <div class="modal-content" style="width: 800px; text-align:center;">
      <i class="fas fa-times modal-close-icon" onclick="closeModal('daily-reward-modal')"></i>
      <h3 style="color:var(--credits); border:none; margin-bottom:5px;">Daily Reward</h3>
      <p style="color:var(--text-muted); margin-bottom:25px;">Claim credits every 24 hours!</p>
      <div class="dr-days">
          <div class="dr-day" id="dr-day-1"><div class="dr-title">Day 1</div><div class="dr-coin">25 TC</div></div>
          <div class="dr-day" id="dr-day-2"><div class="dr-title">Day 2</div><div class="dr-coin">50 TC</div></div>
          <div class="dr-day" id="dr-day-3"><div class="dr-title">Day 3</div><div class="dr-coin">100 TC</div></div>
          <div class="dr-day" id="dr-day-4"><div class="dr-title">Day 4</div><div class="dr-coin">200 TC</div></div>
          <div class="dr-day" id="dr-day-5"><div class="dr-title">Day 5</div><div class="dr-coin">500 TC</div></div>
          <div class="dr-day" id="dr-day-6"><div class="dr-title">Day 6</div><div class="dr-coin">750 TC</div></div>
          <div class="dr-day" id="dr-day-7"><div class="dr-title">Day 7</div><div class="dr-coin">1000 TC</div></div>
      </div>
      <div id="dr-status-container">
          <button class="btn-play" id="btn-claim-reward" style="width:250px; margin:0 auto; background:#ffcc00; color:#000;" onclick="claimDaily()">CLAIM REWARD</button>
      </div>
    </div>
  </div>

  <div id="support-center-modal" class="modal-overlay hidden">
    <div class="modal-content">
      <i class="fas fa-times modal-close-icon" onclick="closeModal('support-center-modal')"></i>
      <h3>Cashier</h3>
      <div style="text-align:center; padding:20px; color:var(--text-muted);">Please use the Admin panel to manually test cashier injections for this build.</div>
    </div>
  </div>

  <div id="rules-modal" class="modal-overlay hidden">
     <div class="modal-content"><i class="fas fa-times modal-close-icon" onclick="closeModal('rules-modal')"></i><h3 id="rules-title">Rules</h3><div id="rules-body" style="font-size:1.1rem; line-height:1.5;"></div></div>
  </div>

  <script>
    // --- SOCKET & GLOBALS ---
    const socket = io();
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    let audioMuted = false, sfxGainVal = 0.8;
    let myCredits = 0;
    let activeSharedGame = null, sState = { status: 'BETTING' }, mySBets = {};
    let dailyTimerInterval = null;

    function delay(ms) { return new Promise(res => setTimeout(res, ms)); }
    function openModal(id) { document.getElementById(id).classList.remove('hidden'); }
    function closeModal(id) { document.getElementById(id).classList.add('hidden'); }
    function showToast(msg, type='success') {
        const t = document.createElement('div'); t.className = `toast toast-${type} show`; t.innerHTML = msg;
        document.getElementById('toast-container').appendChild(t);
        setTimeout(() => { t.classList.remove('show'); setTimeout(()=>t.remove(),400); }, 3000);
    }
    const sfx = { 
        click: () => { if(audioMuted || audioCtx.state==='suspended') return; let o=audioCtx.createOscillator(),g=audioCtx.createGain(); o.type='triangle'; o.frequency.setValueAtTime(600,audioCtx.currentTime); o.frequency.exponentialRampToValueAtTime(100,audioCtx.currentTime+0.03); g.gain.setValueAtTime(0.15*sfxGainVal,audioCtx.currentTime); g.gain.exponentialRampToValueAtTime(0.001,audioCtx.currentTime+0.03); o.connect(g); g.connect(audioCtx.destination); o.start(); o.stop(audioCtx.currentTime+0.03); },
        tick: () => { if(audioMuted || audioCtx.state==='suspended') return; let o=audioCtx.createOscillator(),g=audioCtx.createGain(); o.type='square'; o.frequency.setValueAtTime(1200,audioCtx.currentTime); o.frequency.exponentialRampToValueAtTime(400,audioCtx.currentTime+0.02); g.gain.setValueAtTime(0.05*sfxGainVal,audioCtx.currentTime); g.gain.exponentialRampToValueAtTime(0.001,audioCtx.currentTime+0.02); o.connect(g); g.connect(audioCtx.destination); o.start(); o.stop(audioCtx.currentTime+0.02); },
        deal: () => { if(audioMuted || audioCtx.state==='suspended') return; let o=audioCtx.createOscillator(),g=audioCtx.createGain(); o.type='triangle'; o.frequency.setValueAtTime(300,audioCtx.currentTime); g.gain.setValueAtTime(0.1*sfxGainVal,audioCtx.currentTime); g.gain.exponentialRampToValueAtTime(0.01,audioCtx.currentTime+0.1); o.connect(g); g.connect(audioCtx.destination); o.start(); o.stop(audioCtx.currentTime+0.1); },
        win: () => { if(audioMuted || audioCtx.state==='suspended') return; [440,660,880].forEach((f,i)=>setTimeout(()=>{let o=audioCtx.createOscillator(),g=audioCtx.createGain(); o.type='sine'; o.frequency.setValueAtTime(f,audioCtx.currentTime); g.gain.setValueAtTime(0.1*sfxGainVal,audioCtx.currentTime); g.gain.exponentialRampToValueAtTime(0.01,audioCtx.currentTime+0.3); o.connect(g); g.connect(audioCtx.destination); o.start(); o.stop(audioCtx.currentTime+0.3);},i*100)); },
        lose: () => { if(audioMuted || audioCtx.state==='suspended') return; [200,150].forEach((f,i)=>setTimeout(()=>{let o=audioCtx.createOscillator(),g=audioCtx.createGain(); o.type='sawtooth'; o.frequency.setValueAtTime(f,audioCtx.currentTime); g.gain.setValueAtTime(0.1*sfxGainVal,audioCtx.currentTime); g.gain.exponentialRampToValueAtTime(0.01,audioCtx.currentTime+0.3); o.connect(g); g.connect(audioCtx.destination); o.start(); o.stop(audioCtx.currentTime+0.3);},i*200)); },
        lock: () => { if(audioMuted || audioCtx.state==='suspended') return; let o=audioCtx.createOscillator(),g=audioCtx.createGain(); o.type='square'; o.frequency.setValueAtTime(400,audioCtx.currentTime); g.gain.setValueAtTime(0.1*sfxGainVal,audioCtx.currentTime); g.gain.exponentialRampToValueAtTime(0.01,audioCtx.currentTime+0.1); o.connect(g); g.connect(audioCtx.destination); o.start(); o.stop(audioCtx.currentTime+0.1); },
        coin: () => { if(audioMuted || audioCtx.state==='suspended') return; for(let i=0;i<10;i++) setTimeout(()=>{let o=audioCtx.createOscillator(),g=audioCtx.createGain(); o.type='square'; o.frequency.setValueAtTime(1500+i*100,audioCtx.currentTime); g.gain.setValueAtTime(0.05*sfxGainVal,audioCtx.currentTime); g.gain.exponentialRampToValueAtTime(0.01,audioCtx.currentTime+0.02); o.connect(g); g.connect(audioCtx.destination); o.start(); o.stop(audioCtx.currentTime+0.02);}, i*30); }
    };
    document.addEventListener('mousedown', (e) => { if(e.target.closest('button, .mode-card, .game-card')) sfx.click(); });

    // --- AUTH ---
    function switchAuthTab(tab) {
        document.querySelectorAll('.auth-tab').forEach(t=>t.classList.remove('active'));
        if(tab==='login') { document.querySelectorAll('.auth-tab')[0].classList.add('active'); document.getElementById('auth-form-login').classList.remove('hidden'); document.getElementById('auth-form-register').classList.add('hidden'); } 
        else { document.querySelectorAll('.auth-tab')[1].classList.add('active'); document.getElementById('auth-form-login').classList.add('hidden'); document.getElementById('auth-form-register').classList.remove('hidden'); }
    }
    function toggleInputPwd(id, icon) { let i = document.getElementById(id); if(i.type==="password"){i.type="text";icon.className="fas fa-eye-slash";}else{i.type="password";icon.className="fas fa-eye";} }
    function submitAuth(m) {
        let u = document.getElementById(m==='login'?'login-user':'reg-user').value.trim();
        let p = document.getElementById(m==='login'?'login-pass':'reg-pass').value;
        if(!u || !p) return document.getElementById(m==='login'?'auth-error-login':'auth-error-register').innerText = "Fill all fields";
        socket.emit(m, {username: u, password: p});
    }
    socket.on('authError', (m) => { document.getElementById('auth-error-login').innerText = m; document.getElementById('auth-error-register').innerText = m; });
    socket.on('registerSuccess', (m) => { document.getElementById('auth-error-register').innerText = m; setTimeout(()=>switchAuthTab('login'), 1000); });
    socket.on('loginSuccess', (d) => {
        myCredits = d.credits; document.getElementById('player-name-display').innerText = d.username; document.getElementById('nav-credits').innerText = myCredits.toLocaleString();
        setupDailyReward(d.daily);
        document.getElementById('auth-container').classList.add('hidden'); document.getElementById('app-container').style.display='block';
        if (audioCtx.state === 'suspended') audioCtx.resume(); showToast("Logged in!");
    });
    socket.on('balanceUpdate', (c) => { if(c>myCredits){let p=document.getElementById('pill-credits'); p.classList.remove('anim-pop'); void p.offsetWidth; p.classList.add('anim-pop'); sfx.win();} myCredits = c; document.getElementById('nav-credits').innerText = myCredits.toLocaleString(); });

    // --- DAILY REWARD ---
    function setupDailyReward(daily) {
        for(let i=1; i<=7; i++) {
            let el = document.getElementById('dr-day-'+i);
            el.className = 'dr-day';
            if(i < daily.day) el.classList.add('claimed');
            else if(i === daily.day) {
                el.classList.add('active');
                if(!daily.canClaim) el.classList.add('active-claimed');
            }
        }
        let sc = document.getElementById('dr-status-container');
        if(daily.canClaim) {
            sc.innerHTML = `<button class="btn-play" id="btn-claim-reward" style="width:250px; margin:0 auto; background:#ffcc00; color:#000;" onclick="claimDaily()">CLAIM REWARD</button>`;
        } else {
            startDailyTimer(daily.nextClaim);
        }
    }
    function claimDaily() { socket.emit('claimDaily'); }
    socket.on('dailyClaimed', (d) => {
        document.querySelector('.dr-day.active').classList.add('active-claimed');
        startDailyTimer(d.nextClaim);
        showToast(`+${d.amt} TC Claimed!`);
    });
    function startDailyTimer(nextClaimDate) {
        let sc = document.getElementById('dr-status-container');
        sc.innerHTML = `<div class="dr-status-text">COME BACK TOMORROW</div><div class="dr-timer" id="dr-timer-display">--:--:--</div>`;
        let dest = new Date(nextClaimDate).getTime();
        if(dailyTimerInterval) clearInterval(dailyTimerInterval);
        dailyTimerInterval = setInterval(() => {
            let now = new Date().getTime(); let d = dest - now;
            if(d <= 0) { clearInterval(dailyTimerInterval); sc.innerHTML = `<button class="btn-play" onclick="location.reload()" style="width:250px; margin:0 auto; background:#ffcc00; color:#000;">REFRESH TO CLAIM</button>`; return; }
            let h = Math.floor((d%(1000*60*60*24))/(1000*60*60)); let m = Math.floor((d%(1000*60*60))/(1000*60)); let s = Math.floor((d%(1000*60))/1000);
            document.getElementById('dr-timer-display').innerText = `${h}h ${m}m ${s}s`;
        }, 1000);
    }

    // --- NAVIGATION ---
    function switchView(v) { document.querySelectorAll('.view-container').forEach(e=>e.classList.add('hidden')); document.getElementById('view-'+v).classList.remove('hidden'); if(v==='casino') openLobbyMode('modes'); }
    function openLobbyMode(m) { ['modes','indiv','shared'].forEach(x=>{let el=document.getElementById('lobby-'+x); if(el) el.classList.add('hidden');}); document.getElementById('lobby-'+m).classList.remove('hidden'); if(m==='modes'){document.getElementById('lobby-modes').style.display='flex'; document.querySelector('.casino-title').classList.remove('hidden');} else{document.getElementById('lobby-modes').style.display='none'; document.querySelector('.casino-title').classList.add('hidden');} }
    function openGame(g) { switchView('game-'+g); document.querySelectorAll('.result-box').forEach(b=>b.style.display='none'); }
    function backToCasino() { switchView('casino'); }
    function openRules(k) { document.getElementById('rules-title').innerText=gameInfoMap[k].title; document.getElementById('rules-body').innerHTML=gameInfoMap[k].body; openModal('rules-modal'); }
    const gameInfoMap = { 'dice':{title:"Dice",body:"Roll > 50 pays 2x."}, 'coinflip':{title:"Coin",body:"Heads or Tails pays 2x."}, 'blackjack':{title:"Blackjack",body:"Beat dealer to 21."}, 'baccarat':{title:"Baccarat",body:"Closest to 9. Player/Banker/Tie."}, 'perya':{title:"Color Game",body:"Match colors."}, 'dt':{title:"Dragon Tiger",body:"Highest card."}, 'sicbo':{title:"Sic Bo",body:"Big(11-17) / Small(4-10). Triple loses."} };

    // --- SOLO GAMES ---
    function formatRes(bx, b, p, m) { let h=`<div class="res-title">${m}</div>`; if(p>b){h+=`<div class="res-payout" style="color:var(--success)">+${p} TC</div>`; bx.className="result-box win";} else if(p===b){h+=`<div class="res-payout" style="color:white">Push</div>`; bx.className="result-box push";} else{sfx.lose(); h+=`<div class="res-payout" style="color:var(--danger)">-${b} TC</div>`; bx.className="result-box lose";} bx.innerHTML=h; bx.style.display='block'; }

    function playDice() {
        let b = parseInt(document.getElementById('dice-bet').value); if(isNaN(b)||b<=0||b>myCredits) return showToast("Invalid Bet","error");
        document.getElementById('btn-dice').disabled=true; document.getElementById('dice-msg').style.display='none'; document.getElementById('dice-num').style.display='none'; document.getElementById('dice-icon').style.display='block';
        myCredits-=b; document.getElementById('nav-credits').innerText=myCredits.toLocaleString();
        socket.emit('playSolo', {game:'dice', bet:b});
    }
    socket.on('diceResult', d=>{ let t=0, s=setInterval(()=>{ sfx.tick(); t++; if(t>15){clearInterval(s); document.getElementById('dice-icon').style.display='none'; let nd=document.getElementById('dice-num'); nd.style.display='block'; nd.innerText=d.roll; formatRes(document.getElementById('dice-msg'), d.bet, d.payout, `Rolled ${d.roll}`); document.getElementById('btn-dice').disabled=false; } }, 80); });

    function playCoin(c) {
        let b = parseInt(document.getElementById('coin-bet').value); if(isNaN(b)||b<=0||b>myCredits) return showToast("Invalid Bet","error");
        document.getElementById('btn-heads').disabled=true; document.getElementById('btn-tails').disabled=true; document.getElementById('coin-msg').style.display='none';
        myCredits-=b; document.getElementById('nav-credits').innerText=myCredits.toLocaleString(); sfx.coin(); document.getElementById('coin-wrapper').classList.add('tossing');
        socket.emit('playSolo', {game:'coinflip', bet:b, choice:c});
    }
    socket.on('coinResult', d=>{ let co=document.getElementById('coin-obj'); let er=d.result==='Tails'?180:0; co.style.transform=`rotateY(${3600+er}deg)`; setTimeout(()=>{document.getElementById('coin-wrapper').classList.remove('tossing'); formatRes(document.getElementById('coin-msg'), d.bet, d.payout, d.result); document.getElementById('btn-heads').disabled=false; document.getElementById('btn-tails').disabled=false; co.style.transform=`rotateY(${er}deg)`;}, 2500); });

    let bjActive = false;
    function startBlackjack() {
        if(bjActive) return; let b = parseInt(document.getElementById('bj-bet').value); if(isNaN(b)||b<=0||b>myCredits) return showToast("Invalid Bet","error");
        bjActive=true; document.getElementById('btn-bj-deal').disabled=true; document.getElementById('bj-msg').style.display='none'; document.getElementById('bj-start-controls').classList.add('hidden'); document.getElementById('bj-p-hand').innerHTML=''; document.getElementById('bj-d-hand').innerHTML='';
        myCredits-=b; document.getElementById('nav-credits').innerText=myCredits.toLocaleString();
        socket.emit('playSolo', {game:'blackjack', action:'start', bet:b});
    }
    function hitBlackjack() { if(bjActive) { document.getElementById('btn-bj-hit').disabled=true; socket.emit('playSolo', {game:'blackjack', action:'hit'}); } }
    function standBlackjack() { if(bjActive) { bjActive=false; document.getElementById('btn-bj-hit').disabled=true; document.getElementById('btn-bj-stand').disabled=true; socket.emit('playSolo', {game:'blackjack', action:'stand'}); } }
    socket.on('bjUpdate', async (d) => {
        const dh = async (id, sid, c, hs=false) => { let e=document.getElementById(id); e.innerHTML=''; let s=0; for(let i=0;i<c.length;i++){ let html = (hs&&i===1)?`<div class="play-card anim-deal card-back">?</div>`:`<div class="play-card anim-deal"><div class="val">${c[i].val}</div><div class="suit" style="color:${(c[i].suit==='‚ô•'||c[i].suit==='‚ô¶')?'#e60000':'#000'}">${c[i].suit}</div></div>`; e.insertAdjacentHTML('beforeend', html); s+=c[i].bjVal; } document.getElementById(sid).innerText = hs ? c[0].bjVal : s; };
        if(d.event==='deal') { sfx.deal(); await dh('bj-p-hand','bj-p-score',d.pHand); sfx.deal(); await dh('bj-d-hand','bj-d-score',d.dHand,true); document.getElementById('bj-action-controls').classList.remove('hidden'); document.getElementById('btn-bj-hit').disabled=false; document.getElementById('btn-bj-stand').disabled=false; }
        if(d.event==='hit') { sfx.deal(); await dh('bj-p-hand','bj-p-score',d.pHand); document.getElementById('btn-bj-hit').disabled=false; }
        if(d.event==='resolved') { bjActive=false; document.getElementById('bj-action-controls').classList.add('hidden'); document.getElementById('bj-start-controls').classList.remove('hidden'); document.getElementById('btn-bj-deal').disabled=false; sfx.deal(); await dh('bj-d-hand','bj-d-score',d.dHand,false); formatRes(document.getElementById('bj-msg'), d.bet, d.payout, d.msg); }
    });

    // --- SHARED TABLES ---
    function sendChat() { let i=document.getElementById('chat-input'); if(!i.value.trim()) return; socket.emit('sendChat', {room:activeSharedGame, msg:i.value}); i.value=''; }
    socket.on('chatMessage', d => { let c=document.getElementById('sg-chat'); if(!c) return; c.innerHTML+=`<div class="chat-msg ${d.sys?'chat-sys':''}">${d.sys?d.text: `<span class="chat-user">${d.user}</span> ${d.text}`}</div>`; c.scrollTop=c.scrollHeight; });
    socket.on('playerCount', c => { document.getElementById('sg-active-players').innerText = activeSharedGame ? (c[activeSharedGame]||0) : 0; });

    const sConf = {
        'baccarat': {
            setupUI: () => {
                document.getElementById('sg-display').innerHTML=`<div class="dt-arena"><div class="dt-side"><div class="dt-label" style="color:var(--ps-glow)">Player</div><div id="bac-p-score" style="font-size:2rem;font-weight:900;">0</div><div id="bac-p-hand" style="display:flex;gap:5px;width:210px;justify-content:center;"></div></div><div style="font-size:2.5rem;font-weight:300;">VS</div><div class="dt-side"><div class="dt-label" style="color:var(--danger)">Banker</div><div id="bac-b-score" style="font-size:2rem;font-weight:900;">0</div><div id="bac-b-hand" style="display:flex;gap:5px;width:210px;justify-content:center;"></div></div></div><div class="result-box" id="sg-overlay" style="right:20px;"></div>`;
                document.getElementById('sg-controls-container').innerHTML=`<div style="display:flex;justify-content:space-between;align-items:center;"><input type="number" id="sg-bet-input" class="input-control" placeholder="Bet" style="width:150px;"><div style="font-size:1.5rem;font-weight:900;" id="sg-my-bet">0 TC</div></div><div class="bet-grid"><button class="bet-btn" data-choice="Player" style="--tile-color:var(--ps-glow)" onclick="placeSharedBet('Player')">Player 2x</button><button class="bet-btn" data-choice="Tie" style="--tile-color:var(--success)" onclick="placeSharedBet('Tie')">Tie 8x</button><button class="bet-btn" data-choice="Banker" style="--tile-color:var(--danger)" onclick="placeSharedBet('Banker')">Banker 1.95x</button></div>`;
            },
            anim: async d => {
                const draw = (id, sid, arr) => { let e=document.getElementById(id); e.innerHTML=''; let sum=0; arr.forEach(c=>{ let html=`<div class="play-card anim-deal"><div class="val">${c.val}</div><div class="suit" style="color:${(c.suit==='‚ô•'||c.suit==='‚ô¶')?'#e60000':'#000'}">${c.suit}</div></div>`; e.insertAdjacentHTML('beforeend', html); sum+=c.bacVal;}); document.getElementById(sid).innerText=sum%10; sfx.deal(); };
                let pc=[], bc=[];
                pc.push(d.pCards[0]); draw('bac-p-hand','bac-p-score',pc); await delay(500);
                bc.push(d.bCards[0]); draw('bac-b-hand','bac-b-score',bc); await delay(500);
                pc.push(d.pCards[1]); draw('bac-p-hand','bac-p-score',pc); await delay(500);
                bc.push(d.bCards[1]); draw('bac-b-hand','bac-b-score',bc); await delay(500);
                if(d.pCards[2]) { pc.push(d.pCards[2]); draw('bac-p-hand','bac-p-score',pc); await delay(500); }
                if(d.bCards[2]) { bc.push(d.bCards[2]); draw('bac-b-hand','bac-b-score',bc); await delay(500); }
                resOverlay(`${d.winner} Wins`);
            }
        },
        'perya': {
            setupUI: () => {
                document.getElementById('sg-display').innerHTML=`<div style="display:flex;gap:30px;font-size:5rem;"><div class="color-die" id="cd1" style="width:130px;height:130px;border-radius:16px;background:#333;display:flex;align-items:center;justify-content:center;border:2px solid #555;">?</div><div class="color-die" id="cd2" style="width:130px;height:130px;border-radius:16px;background:#333;display:flex;align-items:center;justify-content:center;border:2px solid #555;">?</div><div class="color-die" id="cd3" style="width:130px;height:130px;border-radius:16px;background:#333;display:flex;align-items:center;justify-content:center;border:2px solid #555;">?</div></div><div class="result-box" id="sg-overlay" style="right:20px;"></div>`;
                let bg = `<div class="bet-grid">`; const c=[{i:'Yellow',h:'#ffcc00'},{i:'White',h:'#fff'},{i:'Pink',h:'#ff66b2'},{i:'Blue',h:'#00a2ff'},{i:'Red',h:'#ff3366'},{i:'Green',h:'#00e676'}]; c.forEach(x=>bg+=`<button class="bet-btn" data-choice="${x.i}" style="--tile-color:${x.h}" onclick="placeSharedBet('${x.i}')">${x.i}</button>`);
                document.getElementById('sg-controls-container').innerHTML=`<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;"><input type="number" id="sg-bet-input" class="input-control" placeholder="Bet" style="width:150px;"><div style="font-size:1.5rem;font-weight:900;" id="sg-my-bet">0 TC</div></div>${bg}</div>`;
            },
            anim: async d => {
                let d1=document.getElementById('cd1'), d2=document.getElementById('cd2'), d3=document.getElementById('cd3');
                d1.className='color-die anim-shake'; d2.className='color-die anim-shake'; d3.className='color-die anim-shake'; d1.innerText='';d2.innerText='';d3.innerText=''; sfx.tick();
                await delay(2000);
                const colMap = {'Yellow':'#ffcc00','White':'#fff','Pink':'#ff66b2','Blue':'#00a2ff','Red':'#ff3366','Green':'#00e676'};
                d1.style.background = colMap[d.roll[0]]; d2.style.background = colMap[d.roll[1]]; d3.style.background = colMap[d.roll[2]];
                d1.className='color-die'; d2.className='color-die'; d3.className='color-die';
                resOverlay(d.roll.join(', '));
            }
        },
        'dt': {
            setupUI: () => {
                document.getElementById('sg-display').innerHTML=`<div class="dt-arena"><div class="dt-side"><div class="dt-label" style="color:var(--danger)">Dragon</div><div id="dt-c1" class="play-card card-back" style="width:120px;height:170px;">?</div></div><div style="font-size:2.5rem;font-weight:300;">VS</div><div class="dt-side"><div class="dt-label" style="color:var(--credits)">Tiger</div><div id="dt-c2" class="play-card card-back" style="width:120px;height:170px;">?</div></div></div><div class="result-box" id="sg-overlay" style="right:20px;"></div>`;
                document.getElementById('sg-controls-container').innerHTML=`<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;"><input type="number" id="sg-bet-input" class="input-control" placeholder="Bet" style="width:150px;"><div style="font-size:1.5rem;font-weight:900;" id="sg-my-bet">0 TC</div></div><div class="bet-grid"><button class="bet-btn" data-choice="Dragon" style="--tile-color:var(--danger)" onclick="placeSharedBet('Dragon')">Dragon 2x</button><button class="bet-btn" data-choice="Tie" style="--tile-color:var(--success)" onclick="placeSharedBet('Tie')">Tie 8x</button><button class="bet-btn" data-choice="Tiger" style="--tile-color:var(--credits)" onclick="placeSharedBet('Tiger')">Tiger 2x</button></div>`;
            },
            anim: async d => {
                const draw = (id, c) => { let html=`<div class="play-card anim-deal" style="width:120px;height:170px;font-size:3rem;"><div class="val">${c.val}</div><div class="suit" style="font-size:4rem;color:${(c.suit==='‚ô•'||c.suit==='‚ô¶')?'#e60000':'#000'}">${c.suit}</div></div>`; document.getElementById(id).outerHTML = html; document.querySelectorAll('.play-card')[id==='dt-c1'?0:1].id=id; sfx.deal(); };
                draw('dt-c1', d.dCard); await delay(500); draw('dt-c2', d.tCard); await delay(1000); resOverlay(`${d.winner} Wins`);
            }
        },
        'sicbo': {
            setupUI: () => {
                document.getElementById('sg-display').innerHTML=`<div style="display:flex;gap:30px;font-size:6rem;" id="sb-dice"><i class="fas fa-dice-d6"></i><i class="fas fa-dice-d6"></i><i class="fas fa-dice-d6"></i></div><div id="sb-sum" style="font-size:2rem;font-weight:900;margin-top:20px;color:var(--text-muted);">Waiting...</div><div class="result-box" id="sg-overlay" style="right:20px;"></div>`;
                document.getElementById('sg-controls-container').innerHTML=`<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;"><input type="number" id="sg-bet-input" class="input-control" placeholder="Bet" style="width:150px;"><div style="font-size:1.5rem;font-weight:900;" id="sg-my-bet">0 TC</div></div><div class="bet-grid"><button class="bet-btn" data-choice="Small" style="--tile-color:var(--ps-glow)" onclick="placeSharedBet('Small')">Small (4-10)</button><div style="display:flex;align-items:center;justify-content:center;font-weight:900;color:var(--text-muted);">TRIPLE LOSES</div><button class="bet-btn" data-choice="Big" style="--tile-color:var(--danger)" onclick="placeSharedBet('Big')">Big (11-17)</button></div>`;
            },
            anim: async d => {
                let e = document.getElementById('sb-dice'); e.innerHTML = `<i class="fas fa-dice-d6 anim-shake"></i><i class="fas fa-dice-d6 anim-shake"></i><i class="fas fa-dice-d6 anim-shake"></i>`; sfx.tick();
                await delay(2000);
                const f = ['one','two','three','four','five','six']; e.innerHTML = `<i class="fas fa-dice-${f[d.roll[0]-1]}"></i><i class="fas fa-dice-${f[d.roll[1]-1]}"></i><i class="fas fa-dice-${f[d.roll[2]-1]}"></i>`; sfx.deal();
                document.getElementById('sb-sum').innerText = `Sum: ${d.sum} ${d.winner==='None'?'(Triple!)':''}`;
                resOverlay(d.winner==='None'?'House Wins':`${d.winner} (${d.sum})`);
            }
        }
    };

    function openSharedGame(id) { 
        activeSharedGame = id; document.getElementById('sg-title').innerText = sConf[id].title; mySBets = {}; 
        document.getElementById('sg-chat').innerHTML = '<div class="chat-msg chat-sys">Connected.</div>'; sConf[id].setupUI();
        document.querySelectorAll('.view-container').forEach(d=>d.classList.add('hidden')); document.getElementById('view-shared-game').classList.remove('hidden');
        socket.emit('joinRoom', id);
    }
    function backToSharedLobby() { document.getElementById('view-shared-game').classList.add('hidden'); socket.emit('leaveRoom', activeSharedGame); activeSharedGame=null; switchView('casino'); openLobbyMode('shared'); }

    function placeSharedBet(c) {
        if(sState.status !== 'BETTING') return showToast("Bets Closed!","error");
        let a = parseInt(document.getElementById('sg-bet-input').value); if(isNaN(a)||a<=0||a>myCredits) return showToast("Invalid Bet","error");
        myCredits-=a; document.getElementById('nav-credits').innerText=myCredits.toLocaleString();
        if(!mySBets[c]) mySBets[c]=0; mySBets[c]+=a;
        document.getElementById('sg-my-bet').innerText = Object.values(mySBets).reduce((s,v)=>s+v,0) + " TC";
        document.querySelectorAll('.bet-btn').forEach(b=>{if(mySBets[b.getAttribute('data-choice')])b.classList.add('has-bet');}); sfx.tick();
        socket.emit('placeSharedBet', {room:activeSharedGame, choice:c, amount:a});
    }

    socket.on('timerUpdate', t => { sState.time=t; let b=document.getElementById('sg-timer-box'); if(document.getElementById('sg-timer')) document.getElementById('sg-timer').innerText=t; if(t<=5 && sState.status==='BETTING' && b) b.classList.add('closing'); else if(b) b.classList.remove('closing'); });
    socket.on('lockBets', () => { sState.status='RESOLVING'; let b=document.getElementById('sg-timer-box'); if(b){b.classList.remove('closing');b.style.color='var(--danger)';b.style.borderColor='var(--danger)';} sfx.lock(); });
    socket.on('sharedResults', d => { if(activeSharedGame===d.room && sConf[d.room]) sConf[d.room].anim(d); });
    socket.on('newRound', () => { sState.status='BETTING'; let b=document.getElementById('sg-timer-box'); if(b){b.style.color='white';b.style.borderColor='var(--glass-border)';} document.getElementById('sg-overlay').style.display='none'; if(activeSharedGame) sConf[activeSharedGame].setupUI(); mySBets={}; });

    function resOverlay(msg) {
        let o = document.getElementById('sg-overlay'); let tot = Object.values(mySBets).reduce((s,v)=>s+v,0);
        let h = `<div class="res-title">${msg}</div>`;
        if(tot > 0) h += `<div class="res-payout" style="color:var(--text-muted)">Check Balance</div>`;
        o.innerHTML = h; o.className = "result-box push"; o.style.display = 'block';
    }

    // ANTI-SNOOP
    document.addEventListener('contextmenu', e=>e.preventDefault());
    document.onkeydown = e => { if(e.keyCode===123||(e.ctrlKey&&e.shiftKey&&[73,67,74].includes(e.keyCode))||(e.ctrlKey&&e.keyCode===85)) return false; };
  </script>
</body>
</html>
