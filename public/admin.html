<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel | Stick N' Trade</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="/socket.io/socket.io.js"></script>
<style>
:root { --ps-bg: #000814; --ps-glow: #00a2ff; --glass-bg: rgba(0, 15, 35, 0.65); --glass-border: rgba(255, 255, 255, 0.15); --danger: #ff3366; --success: #00e676; --credits: #ffb400; --text-muted: #8c9eb5; }
* { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Outfit', sans-serif; outline: none; }
body { background: #000510; color: #fff; display: flex; height: 100vh; overflow: hidden; }
::-webkit-scrollbar { width: 8px; } ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 10px; }
.hidden { display: none !important; }
.btn-primary { background: var(--ps-glow); color: #000; border: none; padding: 10px 20px; border-radius: 6px; font-weight: 900; cursor: pointer; transition: 0.2s; text-transform: uppercase; }
.btn-primary:hover { background: #fff; transform: translateY(-2px); }
.input-control { width: 100%; padding: 12px; background: rgba(0,0,0,0.5); border: 1px solid var(--glass-border); color: white; border-radius: 6px; margin-bottom: 15px; }

#auth-container { position: fixed; inset: 0; display: flex; justify-content: center; align-items: center; z-index: 9999; background: rgba(0,0,0,0.9); }
.auth-box { width: 400px; background: var(--glass-bg); padding: 3rem; border-radius: 16px; border: 1px solid var(--glass-border); text-align: center; }

.sidebar { width: 280px; background: rgba(0, 5, 20, 0.85); border-right: 1px solid var(--glass-border); display: flex; flex-direction: column; }
.sidebar-header { padding: 25px 20px; border-bottom: 1px solid var(--glass-border); display: flex; align-items: center; gap: 15px; font-weight: 900; font-size: 1.2rem; text-transform: uppercase; }
.nav-menu { padding: 20px 15px; display: flex; flex-direction: column; gap: 5px; flex: 1; }
.nav-item { display: flex; align-items: center; gap: 15px; padding: 12px 20px; color: var(--text-muted); text-decoration: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: 0.2s; border: 1px solid transparent;}
.nav-item.active { background: rgba(0, 162, 255, 0.15); color: white; border-color: var(--ps-glow); }

.main-area { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
.top-header { height: 70px; background: rgba(0,0,0,0.4); border-bottom: 1px solid var(--glass-border); display: flex; align-items: center; justify-content: space-between; padding: 0 30px; font-weight: 900; font-size: 1.5rem; text-transform: uppercase;}
.content-wrapper { padding: 30px; overflow-y: auto; flex: 1; }

.table-container { background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: 12px; overflow: hidden; margin-bottom: 25px;}
table { width: 100%; border-collapse: collapse; text-align: center; }
th { padding: 15px 10px; font-size: 0.85rem; text-transform: uppercase; color: var(--text-muted); background: rgba(0,0,0,0.4); }
td { padding: 15px 10px; border-bottom: 1px solid rgba(255,255,255,0.05); font-weight: 600; }
.badge { padding: 5px 10px; border-radius: 4px; font-size: 0.75rem; font-weight: 900; text-transform: uppercase; }

.modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.85); z-index: 10000; display: flex; justify-content: center; align-items: center; }
.modal-content { background: var(--glass-bg); width: 450px; padding: 2.5rem; border-radius: 12px; border: 1px solid var(--glass-border); position: relative; }
</style>
</head>
<body>
  <div id="auth-container">
      <div class="auth-box">
          <h2 style="margin-bottom:20px; font-weight:900; letter-spacing:2px;">ADMIN LOGIN</h2>
          <input type="text" id="a-user" class="input-control" placeholder="Username" style="text-align:center;">
          <input type="password" id="a-pass" class="input-control" placeholder="Password" style="text-align:center;">
          <div id="a-err" style="color:var(--danger); margin-bottom:15px; font-weight:800;"></div>
          <button class="btn-primary" style="width:100%;" onclick="login()">SECURE LOGIN</button>
      </div>
  </div>

  <div id="app-container">
      <aside class="sidebar">
        <div class="sidebar-header"><i class="fas fa-shield-alt" style="color:var(--danger);"></i> COMMAND CENTER</div>
        <div class="nav-menu">
          <a class="nav-item active" onclick="nav('users', this)"><i class="fas fa-users"></i> Users</a>
          <a class="nav-item" style="margin-top:auto;" onclick="location.reload()"><i class="fas fa-sign-out-alt"></i> Logout</a>
        </div>
      </aside>
      <main class="main-area">
        <header class="top-header">Player Management</header>
        <div class="content-wrapper">
          <section id="view-users" class="view-section">
            <div class="table-container">
              <table>
                <thead><tr><th>Date</th><th>Username</th><th>Role</th><th>Balance (TC)</th><th>Status</th><th>Actions</th></tr></thead>
                <tbody id="u-tbody"></tbody>
              </table>
            </div>
          </section>
        </div>
      </main>
  </div>

  <div id="edit-modal" class="modal-overlay hidden">
    <div class="modal-content">
      <h3 style="margin-bottom:20px; text-align:center;">Edit Player</h3>
      <input type="hidden" id="e-id">
      <label style="color:var(--text-muted); font-size:0.8rem; font-weight:900;">USERNAME</label>
      <input type="text" id="e-name" class="input-control" disabled style="opacity:0.5;">
      <label style="color:var(--text-muted); font-size:0.8rem; font-weight:900;">ROLE</label>
      <select id="e-role" class="input-control"><option value="Player">Player</option><option value="Admin">Admin</option></select>
      <label style="color:var(--text-muted); font-size:0.8rem; font-weight:900;">CREDITS</label>
      <input type="number" id="e-cred" class="input-control">
      <button class="btn-primary" style="width:100%;" onclick="save()">SAVE</button>
      <button class="btn-primary" style="width:100%; background:transparent; color:white; margin-top:10px;" onclick="document.getElementById('edit-modal').classList.add('hidden')">CANCEL</button>
    </div>
  </div>

  <script>
    const socket = io();
    function login() { socket.emit('adminLogin', {username:document.getElementById('a-user').value, password:document.getElementById('a-pass').value}); }
    socket.on('authError', m => document.getElementById('a-err').innerText = m);
    socket.on('adminLoginSuccess', () => { document.getElementById('auth-container').classList.add('hidden'); document.getElementById('app-container').style.display='flex'; });
    
    socket.on('adminDataSync', d => {
        let tb = document.getElementById('u-tbody'); tb.innerHTML = '';
        d.users.forEach(u => {
            let sC = u.status==='Active' ? 'var(--ps-glow)' : 'var(--text-muted)';
            tb.innerHTML += `<tr><td>${new Date(u.joinDate).toLocaleDateString()}</td><td style="font-weight:900;">${u.username}</td><td>${u.role}</td><td style="color:var(--credits); font-weight:900;">${u.credits}</td><td style="color:${sC}">${u.status}</td><td><button class="btn-primary" style="padding:5px 10px;" onclick="edit('${u._id}','${u.username}','${u.role}',${u.credits})">EDIT</button></td></tr>`;
        });
    });

    function edit(id, n, r, c) { document.getElementById('e-id').value=id; document.getElementById('e-name').value=n; document.getElementById('e-role').value=r; document.getElementById('e-cred').value=c; document.getElementById('edit-modal').classList.remove('hidden'); }
    function save() { socket.emit('adminAction', {type:'editUser', id:document.getElementById('e-id').value, role:document.getElementById('e-role').value, credits:parseInt(document.getElementById('e-cred').value)}); document.getElementById('edit-modal').classList.add('hidden'); }
    
    document.addEventListener('contextmenu', e=>e.preventDefault());
    document.onkeydown = e => { if(e.keyCode===123||(e.ctrlKey&&e.shiftKey&&[73,67,74].includes(e.keyCode))||(e.ctrlKey&&e.keyCode===85)) return false; };
  </script>
</body>
</html>
